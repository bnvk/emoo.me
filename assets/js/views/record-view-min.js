// RECORD
var RecordFeelingView=Backbone.View.extend({initialize:function(){this.render()},render:function(){},events:{"click #log_feeling_use_text":"viewFeelingText","click #log_feeling_use_emoticons":"viewFeelingEmoticons","click #log_feeling_use_audio":"viewFeelingAudio","click a.log_save_feeling":"processFeeling","click div.emoticon_item":"processFeelingEmoticons","click #log_feel_next":"processFeelingText","click #log_experience_next":"processExperience","click #log_describe_next":"processDescribe"},displayRecordType:function(e){UserData.set({default_feeling_type:e});$.each(["text","emoticons","audio"],function(t,n){n===e?$("#record_feeling_"+n).fadeIn():$("#record_feeling_"+n).hide();$("#log_feeling_use_"+n).addClass("icon_small_"+n)});$("div.left_control_links").removeClass("icon_small_text_select icon_small_emoticons_select icon_small_audio_select");$("#log_feeling_use_"+e).removeClass("icon_small_"+e).addClass("icon_small_"+e+"_select")},viewFeeling:function(){LogFeelingModel.startFeeling();if(navigator.geolocation){function e(e){LogFeelingModel.set({geo_lat:e.coords.latitude,geo_lon:e.coords.longitude})}navigator.geolocation.getCurrentPosition(e)}var t=_.template($("#record_feeling").html());this.$el.html(t).hide().delay(250).fadeIn();this.viewFeelingText()},viewFeelingText:function(){this.displayRecordType("text");$("#log_feeling_value").jkey("space, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0",function(e){Lightbox.printUserMessage("Enter only a single word (no spaces or numbers)")});$("#log_feeling_value").jkey("enter",function(e){Backbone.history.navigate("#/record/experience",!0)})},viewFeelingEmoticons:function(){this.displayRecordType("emoticons");$(".emoticon_item").live("mouseover",function(){$(this).css("background-color","#d6d6d6")}).live("mouseleave",function(){$(this).css("background-color","")})},viewFeelingAudio:function(){this.displayRecordType("audio")},processFeelingText:function(){$.validator({elements:[{selector:"#log_feeling_value",rule:"require",field:"Feeling"}],message:"Enter a ",success:function(){LogFeelingModel.processFeeling($("#log_feeling_value").val());Backbone.history.navigate("#/record/experience",!0)},failed:function(){Lightbox.printUserMessage("Please enter how you feel right now")}})},processFeelingEmoticons:function(e){LogFeelingModel.processFeeling($(e.target).data("feeling"));Backbone.history.navigate("#/record/experience",!0)},processFeeling:function(e){e.preventDefault();$.validator({elements:[{selector:"#log_feeling_value",rule:"require",field:"Experience"}],message:"Enter a ",success:function(){$.oauthAjax({oauth:UserData,url:base_url+"api/emoome/logs/create_feeling",type:"POST",dataType:"json",data:LogFeelingModel.returnData(),beforeSend:Lightbox.requestMade("Saving your feeling"),success:function(e){Lightbox.requestComplete(e.message,e.status);if(e.status==="success"){$("#log_completion_message").html(_.shuffle(UIMessages.log_feeling_complete)[0]);Backbone.history.navigate("#/record/thanks",!0)}}})},failed:function(){Lightbox.printUserMessage("Please enter how you feel right now")}})},viewExperience:function(){var e=_.template($("#record_experience").html());this.$el.html(e).hide().delay(250).fadeIn()},processExperience:function(){$.validator({elements:[{selector:"#log_experience_value",rule:"require",field:"Experience"}],message:"Enter a ",success:function(){LogFeelingModel.processExperience();Backbone.history.navigate("#/record/describe",!0)},failed:function(){Lightbox.printUserMessage("Please enter one thing you did today")}})},viewDescribe:function(){var e={describe_this:LogFeelingModel.get("experience")},t=_.template($("#record_describe").html(),e);this.$el.html(t).hide().delay(250).fadeIn();$("#log_describe_1_value, #log_describe_2_value, #log_describe_3_value").jkey("space, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0",function(){Lightbox.printUserMessage("Enter only a single word (no spaces or numbers)")})},processDescribe:function(){console.log("inside processDescribe()");$.validator({elements:[{selector:"#log_describe_1_value",rule:"require",field:"Describe 1"},{selector:"#log_describe_2_value",rule:"require",field:"Describe 2"},{selector:"#log_describe_3_value",rule:"require",field:"Describe 3"}],message:"Enter a ",success:function(){LogFeelingModel.processDescribe();$.oauthAjax({oauth:UserData,url:base_url+"api/emoome/logs/create_experience",type:"POST",dataType:"json",data:LogFeelingModel.returnData(),beforeSend:Lightbox.requestMade("Saving your experience"),success:function(e){Lightbox.requestComplete(e.message,e.status);e.status==="success"&&Backbone.history.navigate("#/record/thanks",!0)}})},failed:function(){Lightbox.printUserMessage("Please enter three words to describe what you did today")}})},viewThanks:function(){this.clearInput();var e={complete_message:_.shuffle(UIMessages.log_feeling_complete)[0]},t=_.template($("#record_thanks").html(),e);this.$el.html(t).hide().delay(250).fadeIn()},clearInput:function(){this.$("#log_val_feeling").val("");this.$("#log_val_experience").val("");this.$("#log_val_describe_1").val("");this.$("#log_val_describe_2").val("");this.$("#log_val_describe_3").val("");this.$("#log_describe_this").html("")}});